{% extends "base.html" %}
{% load static %}

{% block title %}رزومه ساز - پایسیب{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card shadow">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-file-alt me-2"></i>
                    رزومه ساز هوشمند
                </h5>
            </div>
            <div class="card-body">
                <form method="post" id="resume-form">
                    {% csrf_token %}
                    
                    <!-- اطلاعات شخصی -->
                    <div class="mb-4">
                        <h6 class="text-primary border-bottom pb-2">اطلاعات شخصی</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">نام</label>
                                <input type="text" class="form-control" name="first_name" value="{{ user.first_name }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">نام خانوادگی</label>
                                <input type="text" class="form-control" name="last_name" value="{{ user.last_name }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">ایمیل</label>
                                <input type="email" class="form-control" name="email" value="{{ user.email }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">شماره تماس</label>
                                <input type="tel" class="form-control" name="phone" value="{{ user.phone_number }}" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- اطلاعات تحصیلی -->
                    <div class="mb-4">
                        <h6 class="text-primary border-bottom pb-2">اطلاعات تحصیلی</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">دانشگاه</label>
                                <input type="text" class="form-control" name="university" value="{{ profile.university }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">رشته تحصیلی</label>
                                <input type="text" class="form-control" name="field_of_study" value="{{ profile.field_of_study }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">مقطع تحصیلی</label>
                                <select class="form-select" name="degree_level" required>
                                    <option value="bachelor" {% if profile.degree_level == 'bachelor' %}selected{% endif %}>کارشناسی</option>
                                    <option value="master" {% if profile.degree_level == 'master' %}selected{% endif %}>کارشناسی ارشد</option>
                                    <option value="phd" {% if profile.degree_level == 'phd' %}selected{% endif %}>دکتری</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">سال فارغ‌التحصیلی</label>
                                <input type="number" class="form-control" name="graduation_year" value="{{ profile.graduation_year }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">معدل</label>
                                <input type="number" step="0.01" class="form-control" name="gpa" value="{{ profile.gpa }}">
                            </div>
                        </div>
                    </div>
                    
                    <!-- مهارت‌ها -->
                    <div class="mb-4">
                        <h6 class="text-primary border-bottom pb-2">مهارت‌ها</h6>
                        <div class="mb-3">
                            <label class="form-label">مهارت‌های فنی</label>
                            <textarea class="form-control" name="technical_skills" rows="3" placeholder="مهارت‌های برنامه‌نویسی، نرم‌افزارها و...">{{ profile.skills }}</textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">مهارت‌های نرم</label>
                            <textarea class="form-control" name="soft_skills" rows="2" placeholder="کار تیمی، رهبری، ارتباطات و..."></textarea>
                        </div>
                    </div>
                    
                    <!-- تجربیات -->
                    <div class="mb-4">
                        <h6 class="text-primary border-bottom pb-2">تجربیات کاری</h6>
                        <div id="experiences">
                            <div class="experience-item mb-3 p-3 border rounded">
                                <div class="row">
                                    <div class="col-md-6 mb-2">
                                        <input type="text" class="form-control" name="exp_title[]" placeholder="عنوان شغل">
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <input type="text" class="form-control" name="exp_company[]" placeholder="نام شرکت">
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <input type="text" class="form-control" name="exp_start[]" placeholder="تاریخ شروع (مثال: 1400/01)">
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <input type="text" class="form-control" name="exp_end[]" placeholder="تاریخ پایان (مثال: 1401/12)">
                                    </div>
                                    <div class="col-12 mb-2">
                                        <textarea class="form-control" name="exp_description[]" rows="2" placeholder="توضیحات"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="addExperience()">
                            <i class="fas fa-plus me-1"></i>
                            اضافه کردن تجربه
                        </button>
                    </div>
                    
                    <!-- پروژه‌ها -->
                    <div class="mb-4">
                        <h6 class="text-primary border-bottom pb-2">پروژه‌ها</h6>
                        <div id="projects">
                            <div class="project-item mb-3 p-3 border rounded">
                                <div class="row">
                                    <div class="col-md-6 mb-2">
                                        <input type="text" class="form-control" name="proj_title[]" placeholder="نام پروژه">
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <input type="text" class="form-control" name="proj_tech[]" placeholder="تکنولوژی‌های استفاده شده">
                                    </div>
                                    <div class="col-12 mb-2">
                                        <textarea class="form-control" name="proj_description[]" rows="2" placeholder="توضیحات پروژه"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="addProject()">
                            <i class="fas fa-plus me-1"></i>
                            اضافه کردن پروژه
                        </button>
                    </div>
                    
                    <!-- قالب رزومه -->
                    <div class="mb-4">
                        <h6 class="text-primary border-bottom pb-2">انتخاب قالب</h6>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="card template-card" data-template="modern">
                                    <div class="card-body text-center">
                                        <i class="fas fa-file-alt text-primary fs-1"></i>
                                        <h6 class="mt-2">مدرن</h6>
                                        <small class="text-muted">طراحی ساده و مدرن</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card template-card" data-template="professional">
                                    <div class="card-body text-center">
                                        <i class="fas fa-briefcase text-success fs-1"></i>
                                        <h6 class="mt-2">حرفه‌ای</h6>
                                        <small class="text-muted">مناسب برای موقعیت‌های شغلی</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card template-card" data-template="creative">
                                    <div class="card-body text-center">
                                        <i class="fas fa-palette text-warning fs-1"></i>
                                        <h6 class="mt-2">خلاقانه</h6>
                                        <small class="text-muted">برای مشاغل خلاق</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" name="template" value="modern" id="selected-template">
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="button" class="btn btn-outline-secondary" onclick="previewResume()">
                            <i class="fas fa-eye me-2"></i>
                            پیش‌نمایش
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-download me-2"></i>
                            دانلود رزومه
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <!-- پیش‌نمایش رزومه -->
        <div class="card shadow">
            <div class="card-header">
                <h6 class="mb-0">پیش‌نمایش رزومه</h6>
            </div>
            <div class="card-body">
                <div id="resume-preview" class="resume-preview">
                    <div class="text-center text-muted">
                        <i class="fas fa-file-alt fs-1"></i>
                        <p>رزومه شما اینجا نمایش داده می‌شود</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- راهنما -->
        <div class="card shadow mt-3">
            <div class="card-header">
                <h6 class="mb-0">راهنمای رزومه ساز</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled small">
                    <li><i class="fas fa-check text-success me-2"></i>اطلاعات شخصی را کامل کنید</li>
                    <li><i class="fas fa-check text-success me-2"></i>مهارت‌های خود را لیست کنید</li>
                    <li><i class="fas fa-check text-success me-2"></i>تجربیات کاری را اضافه کنید</li>
                    <li><i class="fas fa-check text-success me-2"></i>پروژه‌های مهم را ذکر کنید</li>
                    <li><i class="fas fa-check text-success me-2"></i>قالب مناسب را انتخاب کنید</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.template-card {
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.template-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.template-card.selected {
    border-color: var(--primary-color);
    background-color: #f8f9fa;
}

.resume-preview {
    min-height: 400px;
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
    font-size: 12px;
}

.experience-item, .project-item {
    background-color: #f8f9fa;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// انتخاب قالب
document.querySelectorAll('.template-card').forEach(card => {
    card.addEventListener('click', function() {
        document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
        this.classList.add('selected');
        document.getElementById('selected-template').value = this.dataset.template;
    });
});

// اضافه کردن تجربه
function addExperience() {
    const container = document.getElementById('experiences');
    const newItem = document.createElement('div');
    newItem.className = 'experience-item mb-3 p-3 border rounded';
    newItem.innerHTML = `
        <div class="row">
            <div class="col-md-6 mb-2">
                <input type="text" class="form-control" name="exp_title[]" placeholder="عنوان شغل">
            </div>
            <div class="col-md-6 mb-2">
                <input type="text" class="form-control" name="exp_company[]" placeholder="نام شرکت">
            </div>
            <div class="col-md-6 mb-2">
                <input type="text" class="form-control" name="exp_start[]" placeholder="تاریخ شروع">
            </div>
            <div class="col-md-6 mb-2">
                <input type="text" class="form-control" name="exp_end[]" placeholder="تاریخ پایان">
            </div>
            <div class="col-12 mb-2">
                <textarea class="form-control" name="exp_description[]" rows="2" placeholder="توضیحات"></textarea>
            </div>
            <div class="col-12">
                <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeItem(this)">
                    <i class="fas fa-trash me-1"></i>
                    حذف
                </button>
            </div>
        </div>
    `;
    container.appendChild(newItem);
}

// اضافه کردن پروژه
function addProject() {
    const container = document.getElementById('projects');
    const newItem = document.createElement('div');
    newItem.className = 'project-item mb-3 p-3 border rounded';
    newItem.innerHTML = `
        <div class="row">
            <div class="col-md-6 mb-2">
                <input type="text" class="form-control" name="proj_title[]" placeholder="نام پروژه">
            </div>
            <div class="col-md-6 mb-2">
                <input type="text" class="form-control" name="proj_tech[]" placeholder="تکنولوژی‌ها">
            </div>
            <div class="col-12 mb-2">
                <textarea class="form-control" name="proj_description[]" rows="2" placeholder="توضیحات"></textarea>
            </div>
            <div class="col-12">
                <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeItem(this)">
                    <i class="fas fa-trash me-1"></i>
                    حذف
                </button>
            </div>
        </div>
    `;
    container.appendChild(newItem);
}

// حذف آیتم
function removeItem(button) {
    button.closest('.experience-item, .project-item').remove();
}

// پیش‌نمایش رزومه
function previewResume() {
    const formData = new FormData(document.getElementById('resume-form'));
    const preview = document.getElementById('resume-preview');
    
    // در اینجا می‌توانید از AJAX برای ارسال داده‌ها و دریافت پیش‌نمایش استفاده کنید
    preview.innerHTML = `
        <div class="text-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">در حال بارگذاری...</span>
            </div>
            <p class="mt-2">در حال تولید پیش‌نمایش...</p>
        </div>
    `;
    
    // شبیه‌سازی پیش‌نمایش
    setTimeout(() => {
        preview.innerHTML = generateResumePreview(formData);
    }, 1000);
}

// تولید پیش‌نمایش رزومه
function generateResumePreview(formData) {
    const template = formData.get('template') || 'modern';
    
    return `
        <div class="resume-${template}">
            <div class="text-center mb-3">
                <h4>${formData.get('first_name')} ${formData.get('last_name')}</h4>
                <p class="text-muted">${formData.get('email')} | ${formData.get('phone')}</p>
            </div>
            
            <div class="mb-3">
                <h6 class="text-primary">اطلاعات تحصیلی</h6>
                <p><strong>${formData.get('university')}</strong> - ${formData.get('field_of_study')}</p>
                <p>مقطع: ${formData.get('degree_level')} | سال: ${formData.get('graduation_year')}</p>
            </div>
            
            <div class="mb-3">
                <h6 class="text-primary">مهارت‌ها</h6>
                <p>${formData.get('technical_skills')}</p>
            </div>
            
            <div class="mb-3">
                <h6 class="text-primary">تجربیات</h6>
                <p>اطلاعات تجربیات اینجا نمایش داده می‌شود</p>
            </div>
        </div>
    `;
}

// انتخاب قالب پیش‌فرض
document.querySelector('.template-card[data-template="modern"]').classList.add('selected');
</script>
{% endblock %}
